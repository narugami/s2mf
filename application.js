(function(){$(function(){var e,i;return i=function(e){return $("#alert").text(e).show()},window.File&&window.FileReader&&window.FileList&&window.Blob?($("#bank").val(null!=(e=Cookies.get("bank"))?e:"Suica"),$("#disable_transfers").prop("checked","true"===Cookies.get("disable_transfers")),$("#disable_duplicates").prop("checked","true"===Cookies.get("disable_duplicates")),$("#select_file").click(function(){return $("#input_file").click()}),$("#input_file").change(function(){var e,t,r,s,n;if(1===this.files.length)return t=$("#disable_transfers").prop("checked"),e=$("#disable_duplicates").prop("checked"),r=this.files[0],s=r.name,s.match(/\.csv$/)?r.size<5120?(n=new FileReader,n.onerror=function(){return i(s+"の読み込みに失敗しました。")},n.onload=function(){var r,n,a,o,l,c,d;return r=/^カードID=\w+?\r\n/,r.test(this.result)?(c=this.result.replace(r,""),o="計算対象,金融機関,日付,振替,大項目,中項目,内容,金額,メモ",a=Cookies.get("last_row"),d=0,l=0,n=!1,Papa.parse(c,{error:function(){return i(s+"の読み込みに失敗しました。")},step:function(i){var r,s,u,p,f,k,b,h,_,v,w,C;return u=i.meta.cursor,_=c.substr(l,u-l),l=u,v=i.data[0],d+=1,10===v.length&&1!==d?(2===d&&Cookies.set("last_row",_,{expires:7300}),e&&_===a&&(n=!0),h=-parseInt((""+v[7]).split(",").join("").trim()),C=h>0,k=!(n||t&&C),r=$("#bank").val(),p=""+v[0],f=(""+v[2]+v[3]+" "+v[5]+v[6]).trim(),b=""+v[9],s="",w="",C||(b.indexOf("ﾊﾞｽ")>=0?(s="交通費",w="バス"):b.indexOf("物販")>=0?(s="食費",w="その他食費",f="物販"):(s="交通費",w="電車")),o+="\n"+(0|k)+","+r+","+p+","+(0|C)+","+s+","+w+","+f+","+h+","+b):void 0},complete:function(e){var i;return 0===e.errors.length&&(i=new Blob([o],{type:"text/csv"}),saveAs(i,s.replace(/\.csv$/,"")+"_converted.csv")),$("#input_file").replaceWith($("#input_file").clone(!0)),Cookies.set("bank",$("#bank").val()),Cookies.set("disable_transfers",$("#disable_transfers").prop("checked")),Cookies.set("disable_duplicates",$("#disable_duplicates").prop("checked"))}})):void i(s+"はSFCard Viewer 2で出力されたCSVファイルではありません。")},n.readAsText(r,"shift-jis")):void i(s+"は容量が大きすぎます。"):void i(s+"はCSVファイルではありません。")})):(i("お使いのブラウザでは利用できません。"),$("#select_file").prop("disabled",!0))})}).call(this);
