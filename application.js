(function(){$(function(){var e,i,t,s;return s=function(e){return $("#alert").text(e).show()},window.File&&window.FileReader&&window.FileList&&window.Blob?($("#bank").val(null!=(e=Cookies.get("bank"))?e:"Suica"),$("#disable_transfers").prop("checked",null!=(i=Cookies.get("disable_transfers"))?i:!0),$("#disable_duplicates").prop("checked",null!=(t=Cookies.get("disable_duplicates"))?t:!0),$("#select_file").click(function(){return $("#input_file").click()}),$("#input_file").change(function(){var e,i,t,r,n;if(1===this.files.length)return i=$("#disable_transfers").prop("checked"),e=$("#disable_duplicates").prop("checked"),t=this.files[0],r=t.name,r.match(/\.csv$/)?t.size<5120?(n=new FileReader,n.onerror=function(){return s(r+"の読み込みに失敗しました。")},n.onload=function(){var t,n,l,a,o,c,d;return t=/^カードID=\w+?\r\n/,t.test(this.result)?(c=this.result.replace(t,""),a="計算対象,金融機関,日付,振替,大項目,中項目,内容,金額,メモ",l=Cookies.get("last_row"),d=0,o=0,n=!1,Papa.parse(c,{error:function(){return s(r+"の読み込みに失敗しました。")},step:function(t){var s,r,u,p,f,k,h,_,b,$,v,w;return u=t.meta.cursor,b=c.substr(o,u-o),o=u,$=t.data[0],d+=1,10===$.length&&1!==d?(2===d&&Cookies.set("last_row",b,{expires:7300}),e&&b===l&&(n=!0),_=-parseInt((""+$[7]).split(",").join("").trim()),w=_>0,k=!(n||i&&w),s="Suica",p=""+$[0],f=(""+$[2]+$[3]+" "+$[5]+$[6]).trim(),h=""+$[9],r="",v="",w||(h.indexOf("ﾊﾞｽ")>=0?(r="交通費",v="バス"):h.indexOf("物販")>=0?(r="食費",v="その他食費"):(r="交通費",v="電車")),a+="\n"+(0|k)+","+s+","+p+","+(0|w)+","+r+","+v+","+f+","+_+","+h):void 0},complete:function(e){var i;return 0===e.errors.length&&(i=new Blob([a],{type:"text/csv"}),saveAs(i,r.replace(/\.csv$/,"")+"_converted.csv")),$("#input_file").replaceWith($("#input_file").clone(!0)),Cookies.set("bank",$("#bank").val()),Cookies.set("disable_transfers",$("#disable_transfers").prop("checked")),Cookies.set("disable_duplicates",$("#disable_duplicates").prop("checked"))}})):void s(r+"はSFCard Viewer 2で出力されたCSVファイルではありません。")},n.readAsText(t,"shift-jis")):void s(r+"は容量が大きすぎます。"):void s(r+"はCSVファイルではありません。")})):(s("お使いのブラウザでは利用できません。"),$("#select_file").prop("disabled",!0))})}).call(this);
